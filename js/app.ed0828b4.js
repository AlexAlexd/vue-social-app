(function(e){function t(t){for(var r,o,i=t[0],s=t[1],u=t[2],d=0,b=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(c,o)&&c[o]&&b.push(c[o][0]),c[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);l&&l(t);while(b.length)b.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,i=1;i<n.length;i++){var s=n[i];0!==c[s]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},c={app:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/vue-social-app/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=s;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0147":function(e,t,n){},"017f":function(e,t,n){"use strict";n("426a")},"024e":function(e,t,n){"use strict";n("a944")},"106a":function(e,t,n){"use strict";n("0147")},"18f2":function(e,t,n){"use strict";n("b67d")},"1c97":function(e,t,n){"use strict";n("5196")},"1fc6":function(e,t,n){"use strict";n("27a4")},"27a4":function(e,t,n){},"2d1f":function(e,t,n){},"3c8e":function(e,t,n){"use strict";n("4580")},"3d78":function(e,t,n){},"426a":function(e,t,n){},4580:function(e,t,n){},"4d21":function(e,t,n){},5196:function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23"),c={class:"container"},a={key:0,class:"main-spinner"},o={key:1},i={class:"content"};function s(e,t,n,s,u,l){var d=Object(r["F"])("Spinner"),b=Object(r["F"])("Header"),f=Object(r["F"])("router-view");return Object(r["z"])(),Object(r["g"])("div",c,[e.showLoader?(Object(r["z"])(),Object(r["g"])("div",a,[Object(r["j"])(d,{big:!0})])):(Object(r["z"])(),Object(r["g"])("div",o,[e.$route.meta.header?(Object(r["z"])(),Object(r["e"])(b,{key:0})):Object(r["f"])("",!0),Object(r["h"])("div",i,[Object(r["j"])(f,null,{default:Object(r["M"])((function(e){var t=e.Component;return[(Object(r["z"])(),Object(r["e"])(r["b"],null,[(Object(r["z"])(),Object(r["e"])(Object(r["G"])(t)))],1024))]})),_:1})])]))])}var u=n("5530"),l=n("260b"),d=(n("ea7b"),n("66ce"),n("588e"),{apiKey:"AIzaSyAum4k-JnHd_SmE01zZy3V_nt9HaTSuKco",authDomain:"beep-93d1c.firebaseapp.com",databaseURL:"https://beep-93d1c-default-rtdb.firebaseio.com",projectId:"beep-93d1c",storageBucket:"beep-93d1c.appspot.com",messagingSenderId:"48600591572",appId:"1:48600591572:web:f35e194d4d4f7d29bc5f41"});l["a"].initializeApp(d);var b=l["a"].auth(),f=l["a"].database(),m=l["a"].storage();n("1393");function p(e,t,n,c,a,o){return Object(r["z"])(),Object(r["g"])("div",{class:Object(r["s"])(["spinner",{big:n.big}])},null,2)}var h={props:{big:Boolean}},j=(n("fa2c"),n("6b0d")),O=n.n(j);const g=O()(h,[["render",p]]);var v=g,w={class:"header"},_={class:"header__content container"},k={class:"header__logo"},y={class:"header__nav"},x=Object(r["i"])("Подписки"),R=Object(r["i"])("Профиль");function C(e,t,n,c,a,o){var i=Object(r["F"])("router-link");return Object(r["z"])(),Object(r["g"])("header",w,[Object(r["h"])("div",_,[Object(r["h"])("div",k,Object(r["I"])(a.title),1),Object(r["h"])("div",y,[Object(r["j"])(i,{class:"header__link",to:"/"},{default:Object(r["M"])((function(){return[x]})),_:1}),Object(r["j"])(i,{class:"header__link",to:"/profile"},{default:Object(r["M"])((function(){return[R]})),_:1})])])])}var I={data:function(){return{title:""}},created:function(){this.title="Tim"}};n("106a");const S=O()(I,[["render",C]]);var z=S,T=n("5502"),M={components:{Header:z,Spinner:v},computed:Object(u["a"])({},Object(T["d"])(["showLoader"]))};n("e8c2");const P=O()(M,[["render",s]]);var L=P,F=n("1da1"),E=(n("96cf"),n("b0c0"),n("d3b7"),n("6c02")),U={class:"home"};function $(e,t,n,c,a,o){var i=Object(r["F"])("Feed");return Object(r["z"])(),Object(r["g"])("div",U,[Object(r["j"])(i)])}var V={class:"feed"},D={class:"feed__users"},W=["onClick"];function A(e,t,n,c,a,o){var i=Object(r["F"])("UserPoster"),s=Object(r["F"])("Posts");return Object(r["z"])(),Object(r["g"])("div",V,[Object(r["h"])("div",D,[(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["D"])(a.subs,(function(e,t){return Object(r["z"])(),Object(r["g"])("div",{class:Object(r["s"])(["feed__user",{selected:a.uid===a.subs[t].uid}]),key:t,onClick:function(e){return o.selectUser(t)}},[Object(r["j"])(i,{authorUid:e.uid,image:e.image},null,8,["authorUid","image"])],10,W)})),128))]),a.uid?(Object(r["z"])(),Object(r["e"])(s,{key:0,uid:a.uid},null,8,["uid"])):Object(r["f"])("",!0)])}var N={class:"poster"},q={class:"poster__header"},B={class:"poster__info"},H={class:"poster__author"},K={key:0,class:"poster__time"},G=["innerHTML"];function J(e,t,n,c,a,o){var i=Object(r["F"])("Image");return Object(r["z"])(),Object(r["g"])("div",N,[Object(r["h"])("div",q,[Object(r["j"])(i,{src:a.authorInfo.image},null,8,["src"]),Object(r["h"])("div",B,[Object(r["h"])("div",H,Object(r["I"])(a.authorInfo.name),1),n.time?(Object(r["z"])(),Object(r["g"])("div",K,Object(r["I"])(this.formatTime(n.time)),1)):Object(r["f"])("",!0)])]),n.text?(Object(r["z"])(),Object(r["g"])("div",{key:0,class:"poster__content",innerHTML:o.formattedText},null,8,G)):Object(r["f"])("",!0)])}n("a9e3"),n("99af"),n("ac1f"),n("5319"),n("466d"),n("159b"),n("caad"),n("2532"),n("5b81");var Z=["src"],X={key:1,class:"image__plug"};function Q(e,t,n,c,a,o){var i=Object(r["F"])("font-awesome-icon");return Object(r["z"])(),Object(r["g"])("div",{class:Object(r["s"])(["image",{big:n.big,border:!n.src}])},[n.src?(Object(r["z"])(),Object(r["g"])("img",{key:0,src:n.src,class:Object(r["s"])({mask:a.mask,landscape:a.landscape}),onLoad:t[0]||(t[0]=function(){return o.onImageLoad&&o.onImageLoad.apply(o,arguments)})},null,42,Z)):(Object(r["z"])(),Object(r["g"])("div",X,[Object(r["j"])(i,{icon:["fas","user"]})]))],2)}var Y={components:{Spinner:v},props:{src:String,big:Boolean},data:function(){return{mask:!0,landscape:!1}},watch:{src:function(){this.mask=!0}},methods:{onImageLoad:function(e){var t=e.target;this.landscape=t.width>t.height,this.mask=!1}}};n("ae2c");const ee=O()(Y,[["render",Q]]);var te=ee,ne={components:{Image:te},props:{authorUid:String,time:Number,text:String},data:function(){return{authorInfo:{}}},methods:{formatTime:function(e){var t=["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"],n=new Date(e),r=n.getDate(),c=t[n.getMonth()],a=n.getHours(),o=n.getMinutes(),i=o<10?"0".concat(o):o;return"".concat(r," ").concat(c,", ").concat(a,":").concat(i)},fetchAuthorInfo:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.authorUid,t.next=3,f.ref("users/".concat(e.authorUid,"/info/main")).get();case 3:n=t.sent,r=n.val(),e.authorInfo=r;case 6:case"end":return t.stop()}}),t)})))()}},created:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchAuthorInfo();case 2:case"end":return t.stop()}}),t)})))()},computed:{formattedText:function(){var e=this.text;e=e.replace(/\n/g," <br /> ");var t=e.match(/\bhttps?:\/\/\S+/gi);return t&&t.forEach((function(t){var n='<a href="'.concat(t,'" target="_blank" class="link"> ').concat(t," </a>");e.includes(n)||(e=e.replaceAll(t,n))})),e}}};n("e84a");const re=O()(ne,[["render",J]]);var ce=re,ae={class:"posts"},oe={key:0,class:"posts__plug"},ie={key:1,class:"posts__list"},se={ref:"plug"},ue={key:0,class:"spinner-wrapper"};function le(e,t,n,c,a,o){var i=Object(r["F"])("Post"),s=Object(r["F"])("Spinner");return Object(r["z"])(),Object(r["g"])("div",ae,[a.showPlug?(Object(r["z"])(),Object(r["g"])("h3",oe,"Нет постов")):(Object(r["z"])(),Object(r["g"])("div",ie,[(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["D"])(a.posts,(function(e){return Object(r["z"])(),Object(r["e"])(i,{key:JSON.stringify(e),post:e},null,8,["post"])})),128)),Object(r["h"])("div",se,null,512),a.isLoading?(Object(r["z"])(),Object(r["g"])("div",ue,[Object(r["j"])(s,{big:!0})])):Object(r["f"])("",!0)]))])}var de=n("b85c"),be=(n("3ca3"),n("ddb0"),n("d81d"),{key:0,class:"post"}),fe={class:"post__header"},me={class:"post__content"},pe={key:0},he={class:"post__stats"};function je(e,t,n,c,a,o){var i=Object(r["F"])("UserPoster"),s=Object(r["F"])("Player"),u=Object(r["F"])("font-awesome-icon"),l=Object(r["F"])("Comments"),d=Object(r["F"])("Modal");return n.post?(Object(r["z"])(),Object(r["g"])("div",be,[Object(r["h"])("div",fe,[Object(r["j"])(i,{authorUid:n.post.authorUid,time:n.post.time,text:n.post.text},null,8,["authorUid","time","text"])]),Object(r["h"])("div",me,[n.post.file?(Object(r["z"])(),Object(r["g"])("div",pe,[Object(r["j"])(s,{src:n.post.file},null,8,["src"])])):Object(r["f"])("",!0)]),Object(r["h"])("div",he,[Object(r["h"])("div",{class:"post__stat",onClick:t[0]||(t[0]=function(e){return a.isCommentsModalShow=!0})},[Object(r["j"])(u,{icon:["far","comment"]}),Object(r["i"])(" "+Object(r["I"])(0===a.commentsCount?"":a.commentsCount),1)])]),a.isCommentsModalShow?(Object(r["z"])(),Object(r["e"])(d,{key:0,name:"Комментарии",onClose:t[2]||(t[2]=function(e){return a.isCommentsModalShow=!1})},{default:Object(r["M"])((function(){return[Object(r["j"])(l,{postId:n.post.index,uid:n.post.authorUid,onCommentAdd:t[1]||(t[1]=function(e){return a.commentsCount++})},null,8,["postId","uid"])]})),_:1})):Object(r["f"])("",!0)])):Object(r["f"])("",!0)}var Oe={class:"modal-overlay"},ge={class:"modal"},ve={class:"modal__header"},we={class:"modal__name"},_e={class:"modal__body"};function ke(e,t,n,c,a,o){return Object(r["z"])(),Object(r["g"])("div",Oe,[Object(r["h"])("div",ge,[Object(r["h"])("div",ve,[Object(r["h"])("h3",we,Object(r["I"])(n.name),1),Object(r["h"])("button",{class:"modal__close",onClick:t[0]||(t[0]=function(t){return e.$emit("close")})},"×")]),Object(r["h"])("div",_e,[Object(r["E"])(e.$slots,"default")])])])}var ye={props:{name:String},mounted:function(){document.body.classList.add("no-scroll")},unmounted:function(){document.body.classList.remove("no-scroll")}};n("3c8e");const xe=O()(ye,[["render",ke]]);var Re=xe,Ce={class:"comments"},Ie={class:"comments__list"},Se={key:0,class:"spinner-wrapper"},ze={key:1,class:"comments__plug"},Te={key:2},Me={ref:"scrollEl"};function Pe(e,t,n,c,a,o){var i=Object(r["F"])("Spinner"),s=Object(r["F"])("UserPoster"),u=Object(r["F"])("font-awesome-icon");return Object(r["z"])(),Object(r["g"])("div",Ce,[Object(r["h"])("div",Ie,[a.isCommentsFetching?(Object(r["z"])(),Object(r["g"])("div",Se,[Object(r["j"])(i,{big:!0})])):Object(r["f"])("",!0),a.isCommentsFetching||a.comments.length?(Object(r["z"])(),Object(r["g"])("div",Te,[(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["D"])(a.comments,(function(e,t){return Object(r["z"])(),Object(r["e"])(s,{key:t,authorUid:e.authorUid,time:e.time,text:e.text},null,8,["authorUid","time","text"])})),128)),Object(r["h"])("div",Me,null,512)])):(Object(r["z"])(),Object(r["g"])("h3",ze,"Нет комментариев"))]),Object(r["h"])("form",{class:"comments__form",onSubmit:t[1]||(t[1]=Object(r["O"])((function(){return o.sendComment&&o.sendComment.apply(o,arguments)}),["prevent"]))},[Object(r["N"])(Object(r["h"])("input",{type:"text",class:"comments__field input",placeholder:"Введите ваш комментарий",ref:"field","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.commentText=e}),maxlength:"100"},null,512),[[r["K"],a.commentText]]),e.iconMode?(Object(r["z"])(),Object(r["g"])("button",{key:0,class:Object(r["s"])(["comments__send btn btn-primary",{disabled:a.isCommentSending}]),type:"submit"},[Object(r["j"])(u,{icon:["fas","check"]})],2)):(Object(r["z"])(),Object(r["g"])("button",{key:1,class:Object(r["s"])(["comments__send btn btn-primary",{disabled:a.isCommentSending}]),type:"submit"},"Отправить",2))],32)])}n("07ac");var Le={props:{postId:Number,uid:String},components:{UserPoster:ce,Spinner:v},inject:["increaseCount"],data:function(){return{comments:[],showPlug:!1,commentText:"",isCommentSending:!1,isCommentsFetching:!1}},methods:{fetchComments:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isCommentsFetching=!0,t.next=3,e.createRef("comments").get();case 3:n=t.sent,r=n.val(),r&&(e.comments=Object.values(r),e.scrollToComment()),e.isCommentsFetching=!1;case 7:case"end":return t.stop()}}),t)})))()},sendComment:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.commentText&&!e.isCommentSending){t.next=2;break}return t.abrupt("return");case 2:return e.isCommentSending=!0,n={text:e.commentText,time:Date.now(),authorUid:e.user.main.uid},r=e.createRef("comments").push(),t.next=7,r.set(n);case 7:return t.next=9,e.increaseCount("users/".concat(e.uid,"/posts/").concat(e.postId,"/commentsCount"));case 9:e.commentText="",e.comments.push(n),e.isCommentSending=!1,e.$emit("commentAdd"),e.scrollToComment();case 14:case"end":return t.stop()}}),t)})))()},createRef:function(e){return f.ref("users/".concat(this.uid,"/posts/").concat(this.postId,"/").concat(e))},scrollToComment:function(){var e=this;this.$nextTick((function(){return e.$refs.scrollEl.scrollIntoView()}))}},created:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchComments();case 2:case"end":return t.stop()}}),t)})))()},mounted:function(){this.$refs.field.focus()},computed:Object(u["a"])({},Object(T["d"])(["user","iconMode"]))};n("fcfe");const Fe=O()(Le,[["render",Pe]]);var Ee=Fe,Ue={class:"player"},$e={class:"vertical-center offset"},Ve={key:0,class:"player__mute"};function De(e,t,n,c,a,o){var i=Object(r["F"])("font-awesome-icon");return Object(r["z"])(),Object(r["g"])("div",Ue,[Object(r["h"])("button",{class:"player__btn",onClick:t[0]||(t[0]=function(){return o.togglePlay&&o.togglePlay.apply(o,arguments)})},[a.isPaused?(Object(r["z"])(),Object(r["e"])(i,{key:0,icon:["fas","play"]})):(Object(r["z"])(),Object(r["e"])(i,{key:1,icon:["fas","pause"]}))]),Object(r["h"])("div",$e,[Object(r["i"])(Object(r["I"])(o.formatTime(a.currentTime))+" ",1),Object(r["h"])("div",{class:"track vertical-center offset",onClick:t[1]||(t[1]=function(){return o.seek&&o.seek.apply(o,arguments)})},[Object(r["h"])("div",{class:"seek",style:Object(r["t"])({width:a.trackWidth+"px"})},[Object(r["h"])("div",{class:"progress",style:Object(r["t"])({width:a.progressWidth+"px"})},null,4)],4)]),Object(r["i"])(" "+Object(r["I"])(o.formatTime(a.duration)),1)]),e.getIconMode?Object(r["f"])("",!0):(Object(r["z"])(),Object(r["g"])("div",Ve,[Object(r["h"])("button",{class:"player__btn",onClick:t[2]||(t[2]=function(){return o.toggleMute&&o.toggleMute.apply(o,arguments)})},[a.isMuted?(Object(r["z"])(),Object(r["e"])(i,{key:0,icon:["fas","volume-mute"]})):(Object(r["z"])(),Object(r["e"])(i,{key:1,icon:["fas","volume-up"]}))]),Object(r["h"])("div",{class:"track vertical-center offset",onClick:t[3]||(t[3]=function(){return o.volumeSeek&&o.volumeSeek.apply(o,arguments)})},[Object(r["h"])("div",{class:"seek",style:Object(r["t"])({width:a.volumeTrackWidth+"px"})},[Object(r["h"])("div",{class:"progress",style:Object(r["t"])({width:a.volumeProgressWidth+"px"})},null,4)],4)])]))])}var We={props:{src:String},data:function(){return{isPaused:!0,isMuted:!1,audio:null,currentTime:0,duration:0,progressWidth:0,trackWidth:120,volumeProgressWidth:0,volumeTrackWidth:60}},mounted:function(){var e=this;this.audio=new Audio(this.src),this.audio.onended=function(){return e.isPaused=!0},this.audio.onloadedmetadata=function(){var t=Object(F["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.duration=Math.floor(e.audio.duration);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.audio.ontimeupdate=function(){e.currentTime=e.audio.currentTime,e.updateLineWidth()},this.volumeToPx()},methods:{toggleMute:function(){this.audio.muted=!this.audio.muted,this.isMuted=this.audio.muted},togglePlay:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.audio.paused){t.next=5;break}return t.next=3,e.audio.play();case 3:t.next=6;break;case 5:e.audio.pause();case 6:e.isPaused=e.audio.paused;case 7:case"end":return t.stop()}}),t)})))()},formatTime:function(e){var t=Math.floor(e%3600/60),n=Math.floor(e%60),r="".concat(t,":").concat(n<10?"0":"").concat(n);return r},updateLineWidth:function(){this.progressWidth=this.audio.currentTime/this.duration*this.trackWidth},seek:function(e){var t=e.offsetX,n=t/this.trackWidth*this.duration;this.audio.currentTime=n},volumeSeek:function(e){var t=e.offsetX;this.volumeProgressWidth=t,this.audio.volume=t/this.volumeTrackWidth},volumeToPx:function(){var e=100*this.audio.volume;this.volumeProgressWidth=this.volumeTrackWidth/100*e}},computed:Object(u["a"])({},Object(T["b"])(["getIconMode"]))};n("692c");const Ae=O()(We,[["render",De]]);var Ne=Ae,qe={components:{Image:Image,Modal:Re,Comments:Ee,UserPoster:ce,Player:Ne},props:{post:Object},data:function(){return{isCommentsModalShow:!1,commentsCount:0}},mounted:function(){this.commentsCount=this.post.commentsCount}};n("18f2");const Be=O()(qe,[["render",je]]);var He=Be,Ke={components:{Post:He,Spinner:v},props:{uid:String,newPost:Object},data:function(){return{lastId:void 0,posts:[],itemsCount:5,isLoading:!0,showPlug:!1}},watch:{newPost:function(e){this.showPlug=!1,this.isLoading=!1,this.posts.unshift(e)},uid:function(e){this.lastId=void 0,this.posts=[],this.showPlug=!1,this.fetchPosts()}},methods:{loadMore:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r,c,a,o,i,s,u,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(e.lastId<0)){t.next=2;break}return t.abrupt("return");case 2:for(e.isLoading=!0,n=e.lastId-e.itemsCount,r=[],c=e.lastId;c>n;c--)c>0&&(a=f.ref("users/".concat(e.uid,"/posts/").concat(c)).get(),r.push(a));return t.next=8,Promise.all(r);case 8:if(o=t.sent,i=o.map((function(e){return e.val()})),0!==i.length){s=Object(de["a"])(i);try{for(s.s();!(u=s.n()).done;)l=u.value,e.posts.push(l)}catch(d){s.e(d)}finally{s.f()}e.lastId=n}e.isLoading=!1;case 12:case"end":return t.stop()}}),t)})))()},fetchLastId:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=f.ref("users/".concat(e.uid,"/lastId")),t.next=3,n.get();case 3:r=t.sent,c=r.val(),e.lastId=c;case 6:case"end":return t.stop()}}),t)})))()},fetchPosts:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,e.fetchLastId();case 3:if(e.lastId){t.next=7;break}e.showPlug=!0,t.next=9;break;case 7:return t.next=9,e.loadMore();case 9:case"end":return t.stop()}}),t)})))()},onScroll:function(){if(this.posts.length){var e=this.$refs.plug.getBoundingClientRect().top;e===window.innerHeight&&this.loadMore()}}},created:function(){this.fetchPosts()},mounted:function(){window.addEventListener("scroll",this.onScroll)},unmounted:function(){window.removeEventListener("scroll",this.onScroll)}};n("b344");const Ge=O()(Ke,[["render",le]]);var Je=Ge,Ze={components:{UserPoster:ce,Posts:Je},data:function(){return{subs:[],uid:"",subsRef:null}},activated:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.subs=[],e.uid="",e.subsRef=f.ref("users/".concat(e.user.main.uid,"/subs")),t.next=5,e.fetchSubs();case 5:case"end":return t.stop()}}),t)})))()},methods:{selectUser:function(e){this.uid=this.subs[e].uid},fetchSubs:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=!0,e.subsRef.on("child_added",function(){var t=Object(F["a"])(regeneratorRuntime.mark((function t(r){var c,a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return c=r.key,t.next=3,f.ref("users/".concat(c,"/info/main")).get();case 3:a=t.sent,o=a.val(),e.subs.push(o),n&&(e.selectUser(0),n=!1);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})))()}},computed:Object(u["a"])({},Object(T["d"])(["user"]))};n("024e");const Xe=O()(Ze,[["render",A]]);var Qe=Xe,Ye={components:{Feed:Qe}};const et=O()(Ye,[["render",$]]);var tt=et,nt={class:"auth"},rt={class:"auth__logo"},ct={class:"auth__content"};function at(e,t,n,c,a,o){var i=Object(r["F"])("Login");return Object(r["z"])(),Object(r["g"])("div",nt,[Object(r["h"])("h1",rt,Object(r["I"])(a.title),1),Object(r["h"])("div",ct,[Object(r["j"])(i)])])}var ot={class:"tabs"},it={class:"tabs__links"},st={key:0,class:"form__error error-text"};function ut(e,t,n,c,a,o){var i=Object(r["F"])("Field");return Object(r["z"])(),Object(r["g"])("div",ot,[Object(r["h"])("ul",it,[Object(r["h"])("li",{class:Object(r["s"])(["tabs__link",{"tabs__link-selected":!0===a.isLogin}]),onClick:t[0]||(t[0]=function(e){return a.isLogin=!0})},"Войти",2),Object(r["h"])("li",{class:Object(r["s"])(["tabs__link",{"tabs__link-selected":!1===a.isLogin}]),onClick:t[1]||(t[1]=function(e){return a.isLogin=!1})},"Регистрация",2)]),Object(r["h"])("form",{class:"form",onSubmit:t[4]||(t[4]=Object(r["O"])((function(){return o.login&&o.login.apply(o,arguments)}),["prevent"]))},[a.error?(Object(r["z"])(),Object(r["g"])("div",st,Object(r["I"])(a.error),1)):Object(r["f"])("",!0),Object(r["j"])(i,{modelValue:a.email,"onUpdate:modelValue":t[2]||(t[2]=function(e){return a.email=e}),type:"text",placeholder:"Email",autocomplete:"email",class:"form__field",error:c.v$.email.$error?"Неверный email":""},null,8,["modelValue","error"]),Object(r["j"])(i,{modelValue:a.password,"onUpdate:modelValue":t[3]||(t[3]=function(e){return a.password=e}),type:"password",placeholder:"Пароль",autocomplete:"current-password",class:"form__field",error:c.v$.password.$error?"Пароль должен содержать минимум 6 символов":""},null,8,["modelValue","error"]),Object(r["h"])("button",{class:Object(r["s"])(["form__btn btn btn-primary",{disabled:a.isLoading}]),type:"submit"},Object(r["I"])(a.isLogin?"Войти":"Регистрация"),3)],32)])}var lt=n("25a0"),dt=n("e3e1"),bt={class:"field"},ft=["type","placeholder","value"],mt={key:0,class:"error-text"};function pt(e,t,n,c,a,o){return Object(r["z"])(),Object(r["g"])("div",bt,[Object(r["h"])("input",{class:Object(r["s"])(["input",{"input-error":n.error}]),type:n.type,placeholder:n.placeholder,value:n.modelValue,onInput:t[0]||(t[0]=function(t){return e.$emit("update:modelValue",t.target.value)})},null,42,ft),n.error?(Object(r["z"])(),Object(r["g"])("div",mt,Object(r["I"])(n.error),1)):Object(r["f"])("",!0)])}var ht={emit:["update:modelValue"],props:{modelValue:String,type:String,placeholder:String,autocomplete:String,error:String}};const jt=O()(ht,[["render",pt]]);var Ot=jt,gt={components:{Field:Ot},data:function(){return{email:"",password:"",isLoading:!1,error:"",isLogin:!0}},setup:function(){return{v$:Object(lt["a"])()}},validations:function(){return{email:{required:dt["d"],email:dt["a"]},password:{required:dt["d"],minLength:Object(dt["c"])(6)}}},watch:{isLogin:function(e){this.error=""}},methods:Object(u["a"])({login:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r,c,a,o,i,s,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.v$.$validate(),!e.v$.$error){t.next=3;break}return t.abrupt("return");case 3:if(e.isLoading=!0,null,t.prev=5,!e.isLogin){t.next=18;break}return t.next=9,b.signInWithEmailAndPassword(e.email,e.password);case 9:return n=t.sent,r=n.user.uid,c=f.ref("users/".concat(r,"/info")),t.next=14,c.get();case 14:a=t.sent,a.val(),t.next=27;break;case 18:return t.next=20,b.createUserWithEmailAndPassword(e.email,e.password);case 20:return o=t.sent,i=o.user.uid,s={info:{main:{name:"Аноним",image:"",uid:i},other:{readersCount:0,postsCount:0}},lastId:0},u=f.ref("users/".concat(i)),t.next=26,u.set(s);case 26:s;case 27:e.$router.replace({name:"profile"}),t.next=34;break;case 30:t.prev=30,t.t0=t["catch"](5),e.error="Ошибка аутентификации",e.isLoading=!1;case 34:e.isLoading=!1;case 35:case"end":return t.stop()}}),t,null,[[5,30]])})))()}},Object(T["c"])(["SET_USER"]))};n("80e5");const vt=O()(gt,[["render",ut]]);var wt=vt,_t={components:{Login:wt},data:function(){return{title:""}},created:function(){this.title="Tim"}};n("907c");const kt=O()(_t,[["render",at]]);var yt=kt,xt={key:0,class:"profile"},Rt={class:"profile__header"},Ct={class:"profile__image"},It={class:"profile__info"},St={class:"profile__left"},zt={class:"profile__name"},Tt={class:"profile__stats"},Mt={class:"profile__stat"},Pt=Object(r["i"])(" Читателей "),Lt={class:"profile__stat"},Ft=Object(r["i"])(" Постов "),Et={class:"profile__right"},Ut={class:"profile__body"},$t={class:"modal-buttons"};function Vt(e,t,n,c,a,o){var i=Object(r["F"])("Image"),s=Object(r["F"])("CopyIdButton"),u=Object(r["F"])("SearchButton"),l=Object(r["F"])("CreatePost"),d=Object(r["F"])("Posts"),b=Object(r["F"])("Edit"),f=Object(r["F"])("Modal");return e.user?(Object(r["z"])(),Object(r["g"])("div",xt,[Object(r["h"])("div",Rt,[Object(r["h"])("div",Ct,[e.user.main?(Object(r["z"])(),Object(r["e"])(i,{key:0,src:e.user.main.image,big:!0},null,8,["src"])):Object(r["f"])("",!0)]),Object(r["h"])("div",It,[Object(r["h"])("div",St,[Object(r["h"])("div",zt,Object(r["I"])(e.user.main.name),1),Object(r["h"])("div",Tt,[Object(r["h"])("span",Mt,[Object(r["h"])("span",null,Object(r["I"])(e.user.other.readersCount),1),Pt]),Object(r["h"])("span",Lt,[Object(r["h"])("span",null,Object(r["I"])(e.user.other.postsCount),1),Ft])]),Object(r["j"])(s),Object(r["j"])(u)]),Object(r["h"])("div",Et,[Object(r["h"])("button",{class:"profile__logout btn btn-danger",onClick:t[0]||(t[0]=function(e){return a.showLogoutModal=!0})},"Выйти"),Object(r["h"])("button",{class:"profile__edit btn",onClick:t[1]||(t[1]=function(e){return a.showEditModal=!0})},"Редактировать")])])]),Object(r["h"])("div",Ut,[Object(r["j"])(l,{onCreate:o.onPostCreate},null,8,["onCreate"])]),Object(r["j"])(d,{uid:e.user.main.uid,newPost:a.newPost},null,8,["uid","newPost"]),a.showEditModal?(Object(r["z"])(),Object(r["e"])(f,{key:0,name:"Редактировать профиль",onClose:t[3]||(t[3]=function(e){return a.showEditModal=!1})},{default:Object(r["M"])((function(){return[Object(r["j"])(b,{onSaved:t[2]||(t[2]=function(e){return a.showEditModal=!1})})]})),_:1})):Object(r["f"])("",!0),a.showLogoutModal?(Object(r["z"])(),Object(r["e"])(f,{key:1,name:"Вы действительно хотите выйти?",onClose:t[6]||(t[6]=function(e){return a.showLogoutModal=!1})},{default:Object(r["M"])((function(){return[Object(r["h"])("div",$t,[Object(r["h"])("button",{class:"btn btn-danger",onClick:t[4]||(t[4]=function(e){return a.showLogoutModal=!1})},"Нет"),Object(r["h"])("button",{class:"btn btn-primary",onClick:t[5]||(t[5]=function(){return o.logOut&&o.logOut.apply(o,arguments)})},"Да")])]})),_:1})):Object(r["f"])("",!0)])):Object(r["f"])("",!0)}var Dt={class:"search-btn"},Wt=Object(r["h"])("span",null,"Поиск по id",-1);function At(e,t,n,c,a,o){var i=Object(r["F"])("font-awesome-icon"),s=Object(r["F"])("Search"),u=Object(r["F"])("Modal");return Object(r["z"])(),Object(r["g"])("div",Dt,[Object(r["h"])("button",{class:"btn-secondary",onClick:t[0]||(t[0]=function(e){return a.showSearchModal=!0})},[Object(r["j"])(i,{icon:["fas","search"]}),Wt]),a.showSearchModal?(Object(r["z"])(),Object(r["e"])(u,{key:0,name:"Поиск",onClose:t[1]||(t[1]=function(e){return a.showSearchModal=!1})},{default:Object(r["M"])((function(){return[Object(r["j"])(s)]})),_:1})):Object(r["f"])("",!0)])}var Nt={class:"search"},qt={class:"error-text"},Bt={key:0},Ht={key:1},Kt={key:0,class:"search__spinner"},Gt={key:1,class:"search__error"},Jt={key:2,class:"search__result"};function Zt(e,t,n,c,a,o){var i=Object(r["F"])("Spinner"),s=Object(r["F"])("UserPoster");return Object(r["z"])(),Object(r["g"])("div",Nt,[Object(r["h"])("div",qt,[e.v$.query.$error?(Object(r["z"])(),Object(r["g"])("span",Bt,"Айди содержит недопустимые символы")):Object(r["f"])("",!0),a.hasError?(Object(r["z"])(),Object(r["g"])("span",Ht,"Ошибка подписки")):Object(r["f"])("",!0)]),Object(r["N"])(Object(r["h"])("input",{type:"text",class:"search__input input",placeholder:"Введите id пользователя",ref:"input","onUpdate:modelValue":t[0]||(t[0]=function(t){return e.v$.query.$model=t}),onInput:t[1]||(t[1]=function(){return o.fetchUser&&o.fetchUser.apply(o,arguments)}),maxlength:"100"},null,544),[[r["K"],e.v$.query.$model]]),a.isLoading?(Object(r["z"])(),Object(r["g"])("div",Kt,[Object(r["j"])(i)])):Object(r["f"])("",!0),a.showPlug?(Object(r["z"])(),Object(r["g"])("div",Gt,"Никого не найдено")):Object(r["f"])("",!0),a.result?(Object(r["z"])(),Object(r["g"])("div",Jt,[Object(r["j"])(s,{authorUid:a.result.uid},null,8,["authorUid"]),a.alreadySubscribed?Object(r["f"])("",!0):(Object(r["z"])(),Object(r["g"])("button",{key:0,class:"btn btn-primary",onClick:t[2]||(t[2]=function(){return o.subscribe&&o.subscribe.apply(o,arguments)})},"Подписатся"))])):Object(r["f"])("",!0)])}var Xt={components:{Spinner:v,UserPoster:ce},inject:["increaseCount"],setup:function(){return{v$:Object(lt["a"])()}},data:function(){return{query:"",result:null,isLoading:!1,showPlug:!1,alreadySubscribed:!1,hasError:null}},validations:function(){return{query:{mustContainLetters:Qt}}},methods:{focusInput:function(){this.$refs.input.focus()},fetchUser:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.v$.$error){t.next=2;break}return t.abrupt("return",e.showPlug=!1);case 2:return e.hasError=!1,e.showPlug=!1,e.isLoading=!0,e.result=null,n=f.ref("users/".concat(e.query,"/info/main")),t.next=9,n.get();case 9:if(r=t.sent,c=r.val(),!c){t.next=18;break}if(e.user.main.uid===c.uid){t.next=16;break}return t.next=15,e.checkIsSub(c.uid);case 15:e.result=c;case 16:t.next=19;break;case 18:e.showPlug=!0;case 19:e.isLoading=!1;case 20:case"end":return t.stop()}}),t)})))()},subscribe:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r,c,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=f.ref("users/".concat(e.user.main.uid,"/subs/").concat(e.result.uid)),t.prev=1,t.next=4,n.set(1);case 4:return r=f.ref("users/".concat(e.result.uid,"/info/other/readersCount")),t.next=7,r.get();case 7:return c=t.sent,a=c.val(),a+=1,t.next=12,r.set(a);case 12:e.alreadySubscribed=!0,t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](1),e.hasError=!0;case 18:case"end":return t.stop()}}),t,null,[[1,15]])})))()},checkIsSub:function(e){var t=this;return Object(F["a"])(regeneratorRuntime.mark((function n(){var r,c,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=f.ref("users/".concat(t.user.main.uid,"/subs/").concat(e)),n.next=3,r.get();case 3:c=n.sent,a=c.val(),t.alreadySubscribed=!!a;case 6:case"end":return n.stop()}}),n)})))()}},mounted:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.focusInput();case 1:case"end":return t.stop()}}),t)})))()},computed:Object(u["a"])({},Object(T["d"])(["user"]))};function Qt(e){return/^[a-zA-Z0-9-]+$/i.test(e)}n("dc9c");const Yt=O()(Xt,[["render",Zt]]);var en=Yt,tn={components:{Modal:Re,Search:en},data:function(){return{showSearchModal:!1}}};n("1fc6");const nn=O()(tn,[["render",At]]);var rn=nn,cn={class:"copy-id-button"};function an(e,t,n,c,a,o){return Object(r["z"])(),Object(r["g"])("div",cn,[Object(r["h"])("button",{class:Object(r["s"])(["btn-secondary",{active:a.isCopy}]),onClick:t[0]||(t[0]=function(){return o.copyId&&o.copyId.apply(o,arguments)})},Object(r["I"])(a.isCopy?"Скопировано":"Копировать id"),3)])}var on={data:function(){return{isCopy:!1}},methods:{copyId:function(){var e=this;this.isCopy||(navigator.clipboard.writeText(this.user.main.uid),this.isCopy=!0,setTimeout((function(){e.isCopy=!1}),1e3))}},computed:Object(u["a"])({},Object(T["d"])(["user"]))};n("017f");const sn=O()(on,[["render",an]]);var un=sn,ln={class:"edit"},dn={class:"edit__field"},bn={class:"edit__footer"};function fn(e,t,n,c,a,o){var i=Object(r["F"])("ImageFileInput"),s=Object(r["F"])("Field"),u=Object(r["F"])("font-awesome-icon");return Object(r["z"])(),Object(r["g"])("div",ln,[Object(r["h"])("form",{onSubmit:t[1]||(t[1]=Object(r["O"])((function(){return o.saveChanges&&o.saveChanges.apply(o,arguments)}),["prevent"]))},[Object(r["j"])(i,{onFileChange:o.onFileInputChange,error:c.v$.file.$error?"Размер файла должен быть до 2МВ":"",src:e.user.main.image},null,8,["onFileChange","error","src"]),Object(r["h"])("div",dn,[Object(r["j"])(s,{modelValue:a.name,"onUpdate:modelValue":t[0]||(t[0]=function(e){return a.name=e}),type:"text",placeholder:"Имя",error:c.v$.name.$error?"Имя может содержать буквы, цифры, пробелы и быть не длинее 20 символов":""},null,8,["modelValue","error"])]),Object(r["h"])("div",bn,[e.getIconMode?(Object(r["z"])(),Object(r["g"])("button",{key:0,class:Object(r["s"])(["edit__submit btn btn-primary",{disabled:a.isLoading}]),type:"submit"},[Object(r["j"])(u,{icon:["fas","check"]})],2)):(Object(r["z"])(),Object(r["g"])("button",{key:1,class:Object(r["s"])(["edit__submit btn btn-primary",{disabled:a.isLoading}]),type:"submit"},"Сохранить",2))])],32)])}var mn={class:"file"},pn={key:0,class:"file__error error-text"};function hn(e,t,n,c,a,o){var i=Object(r["F"])("Image"),s=Object(r["F"])("font-awesome-icon");return Object(r["z"])(),Object(r["g"])("div",mn,[Object(r["h"])("div",{class:Object(r["s"])(["file__preview",{"input-error":n.error}]),onClick:t[0]||(t[0]=function(){return o.triggerFileInput&&o.triggerFileInput.apply(o,arguments)})},[Object(r["j"])(i,{src:a.image,big:!0},null,8,["src"]),Object(r["h"])("span",null,[Object(r["j"])(s,{icon:["fas","camera"]})])],2),Object(r["h"])("input",{type:"file",accept:".png, .jpg, .jfif, .jpeg, .webp",ref:"fileInput",onChange:t[1]||(t[1]=function(){return o.onFileChange&&o.onFileChange.apply(o,arguments)})},null,544),n.error?(Object(r["z"])(),Object(r["g"])("div",pn,Object(r["I"])(n.error),1)):Object(r["f"])("",!0)])}n("2b3d"),n("9861");var jn={props:{error:String,src:String},components:{Image:te},data:function(){return{image:""}},methods:{triggerFileInput:function(){this.$refs.fileInput.click()},onFileChange:function(e){var t=e.target.files[0];t&&(this.image=URL.createObjectURL(t),this.$emit("fileChange",t))}},mounted:function(){this.image=this.src}};n("b9d4");const On=O()(jn,[["render",hn]]);var gn=On,vn={components:{Field:Ot,ImageFileInput:gn},data:function(){return{name:"333",image:"",isLoading:!1,file:null}},setup:function(){return{v$:Object(lt["a"])()}},validations:function(){return{name:{required:dt["d"],mustContainLetters:_n,maxLength:Object(dt["b"])(20)},file:{checkSize:kn}}},methods:Object(u["a"])({saveChanges:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isLoading){t.next=2;break}return t.abrupt("return");case 2:if(e.v$.$validate(),!e.v$.$error){t.next=5;break}return t.abrupt("return");case 5:if(e.isLoading=!0,!e.file){t.next=9;break}return t.next=9,e.uploadImage();case 9:if(e.name===e.user.main.name){t.next=12;break}return t.next=12,e.uploadName();case 12:e.isLoading=!1,e.$emit("saved");case 14:case"end":return t.stop()}}),t)})))()},onFileInputChange:function(e){this.file=e},uploadImage:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r,c,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=m.ref("users/".concat(e.user.main.uid,"/profile-photo")),t.next=3,n.put(e.file);case 3:return t.next=5,n.getDownloadURL();case 5:return r=t.sent,c=e.user.main.uid,a=wn(c,"image"),t.next=10,a.set(r);case 10:e.file=null,e.SET_USER_IMAGE(r);case 12:case"end":return t.stop()}}),t)})))()},uploadName:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.user.main.uid,r=wn(n,"name"),t.next=4,r.set(e.name);case 4:e.SET_USER_NAME(e.name);case 5:case"end":return t.stop()}}),t)})))()}},Object(T["c"])(["SET_USER_IMAGE","SET_USER_NAME"])),computed:Object(u["a"])(Object(u["a"])({},Object(T["d"])(["user"])),Object(T["b"])(["getIconMode"])),mounted:function(){this.name=this.user.main.name}};function wn(e,t){return f.ref("users/".concat(e,"/info/main/").concat(t))}function _n(e){return/^[a-zA-Zа-яА-Я0-9\s]+$/i.test(e)}function kn(e){return!e||e.size<2e6}n("c727");const yn=O()(vn,[["render",fn]]);var xn=yn,Rn={class:"create"},Cn={class:"create__body"},In={key:0},Sn={class:"create__message"},zn={key:1},Tn={class:"modal-buttons"},Mn={key:0,class:"create__buttons"},Pn={key:1,class:"create__buttons"},Ln={key:0};function Fn(e,t,n,c,a,o){var i=Object(r["F"])("StopWatch"),s=Object(r["F"])("font-awesome-icon");return Object(r["z"])(),Object(r["g"])("div",Rn,[Object(r["h"])("div",Cn,[a.isRecordingView?(Object(r["z"])(),Object(r["g"])("div",In,[Object(r["j"])(i),Object(r["h"])("div",Sn,"Максимальная длительность "+Object(r["I"])(a.maxVoiceDuration/1e3)+" секунд",1)])):(Object(r["z"])(),Object(r["g"])("div",zn,[Object(r["N"])(Object(r["h"])("textarea",{class:"create__input",placeholder:"Введите текст поста","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.postText=e}),maxlength:"200"},null,512),[[r["K"],a.postText]])]))]),Object(r["h"])("div",Tn,[a.isRecordingView?(Object(r["z"])(),Object(r["g"])("div",Mn,[e.getIconMode?(Object(r["z"])(),Object(r["g"])("button",{key:0,class:"create__button btn btn-danger",onClick:t[1]||(t[1]=function(){return o.discardRecording&&o.discardRecording.apply(o,arguments)})},[Object(r["j"])(s,{icon:["fas","times"]})])):(Object(r["z"])(),Object(r["g"])("button",{key:1,class:"create__button btn btn-danger",onClick:t[2]||(t[2]=function(){return o.discardRecording&&o.discardRecording.apply(o,arguments)})},"Отмена")),e.getIconMode?(Object(r["z"])(),Object(r["g"])("button",{key:2,class:"create__button btn btn-primary",onClick:t[3]||(t[3]=function(){return o.uploadRecording&&o.uploadRecording.apply(o,arguments)})},[Object(r["j"])(s,{icon:["fas","check"]})])):(Object(r["z"])(),Object(r["g"])("button",{key:3,class:"create__button btn btn-primary",onClick:t[4]||(t[4]=function(){return o.uploadRecording&&o.uploadRecording.apply(o,arguments)})},"Опубликовать"))])):(Object(r["z"])(),Object(r["g"])("div",Pn,[e.getIconMode?(Object(r["z"])(),Object(r["g"])("button",{key:0,class:Object(r["s"])(["create__button btn btn-primary",{disabled:a.isLoading}]),onClick:t[5]||(t[5]=function(){return o.publish&&o.publish.apply(o,arguments)})},[Object(r["j"])(s,{icon:["fas","check"]})],2)):(Object(r["z"])(),Object(r["g"])("button",{key:1,class:Object(r["s"])(["create__button btn btn-primary",{disabled:a.isLoading}]),onClick:t[6]||(t[6]=function(){return o.publish&&o.publish.apply(o,arguments)})},"Опубликовать",2)),Object(r["h"])("button",{class:"create__button btn btn-primary",onClick:t[7]||(t[7]=function(){return o.startRecording&&o.startRecording.apply(o,arguments)})},[Object(r["h"])("span",null,[Object(r["j"])(s,{icon:["fas","microphone"]})]),e.getIconMode?Object(r["f"])("",!0):(Object(r["z"])(),Object(r["g"])("span",Ln,"Записать"))])]))])])}n("498a");var En=n("bea0"),Un=n.n(En),$n={class:"stopwatch"};function Vn(e,t,n,c,a,o){return Object(r["z"])(),Object(r["g"])("div",$n,Object(r["I"])(o.formatTime(a.min))+":"+Object(r["I"])(o.formatTime(a.sec))+":"+Object(r["I"])(o.formatTime(a.nanosec)),1)}var Dn={data:function(){return{interval:null,nanosec:0,sec:0,min:0}},methods:{startTimer:function(){var e=this;this.interval=setInterval((function(){return e.nanosec++}),10)},stopTimer:function(){clearInterval(this.interval)},resetTimer:function(){this.nanosec=0,this.min=0,this.sec=0}},mounted:function(){this.startTimer()},unmounted:function(){this.stopTimer(),this.resetTimer()},watch:{nanosec:function(e){e>99?(this.nanosec=0,this.sec++):e>6e3&&(this.sec=0,this.min++)}},computed:{formatTime:function(){return function(e){return e<10?"0".concat(e):e}}}};const Wn=O()(Dn,[["render",Vn]]);var An=Wn,Nn={components:{StopWatch:An},inject:["increaseCount"],emits:["create"],data:function(){return{postText:"",isLoading:!1,isRecordingView:!1,mediaRecorder:null,stream:null,saveRecording:!1,file:null,canPublish:!1,canPublishTimeout:null,maxDurationTimeout:null,maxVoiceDuration:3e4}},methods:{setWatchVoiceDuration:function(){var e=this;this.maxDurationTimeout=setTimeout((function(){e.discardRecording()}),this.maxVoiceDuration)},clearWatchVoiceDuration:function(){clearTimeout(this.maxDurationTimeout)},publish:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.postText.trim()){t.next=2;break}return t.abrupt("return");case 2:return e.isLoading=!0,t.next=5,e.uploadPost();case 5:e.postText="",e.isLoading=!1;case 7:case"end":return t.stop()}}),t)})))()},uploadPost:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r,c,a,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.user.main.uid,t.next=3,e.increaseCount("users/".concat(n,"/lastId"));case 3:if(r=t.sent,c=f.ref("users/".concat(n,"/posts/").concat(r)),a=null,!e.file){t.next=13;break}return o=m.ref("users/".concat(n,"/audio/").concat(r)),t.next=10,o.put(e.file);case 10:return t.next=12,o.getDownloadURL();case 12:a=t.sent;case 13:return i={text:e.postText||null,file:a,time:Date.now(),index:r,authorUid:n,commentsCount:0},t.next=16,c.set(i);case 16:return t.next=18,e.increaseCount("users/".concat(n,"/info/other/postsCount"));case 18:e.$emit("create",i);case 19:case"end":return t.stop()}}),t)})))()},startRecording:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isRecordingView=!0,e.setWatchVoiceDuration(),e.canPublishTimeout=setTimeout((function(){return e.canPublish=!0}),1e3),navigator.mediaDevices||navigator.mediaDevices.getUserMedia){t.next=6;break}return alert("Невозможно начать запись"),t.abrupt("return");case 6:return t.next=8,navigator.mediaDevices.getUserMedia({audio:!0});case 8:e.stream=t.sent,e.mediaRecorder=new MediaRecorder(e.stream),n=[],e.mediaRecorder.ondataavailable=function(e){return n.push(e.data)},e.mediaRecorder.onstop=Object(F["a"])(regeneratorRuntime.mark((function t(){var c,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(clearTimeout(e.canPublishTimeout),e.canPublish){t.next=3;break}return t.abrupt("return");case 3:if(e.canPublish=!1,!e.saveRecording){t.next=15;break}return c=Date.now()-r,a=new Blob(n,{type:"audio/webm"}),t.next=9,Un()(a,c,{logger:!1});case 9:return e.file=t.sent,n=[],t.next=13,e.uploadPost();case 13:t.next=16;break;case 15:n=[];case 16:e.file=null;case 17:case"end":return t.stop()}}),t)}))),r=Date.now(),e.mediaRecorder.start();case 15:case"end":return t.stop()}}),t)})))()},discardRecording:function(){this.saveRecording=!1,this.stopRecording()},uploadRecording:function(){this.saveRecording=!0,this.stopRecording()},stopRecording:function(){this.isRecordingView=!1,this.clearWatchVoiceDuration(),this.mediaRecorder&&"recording"===this.mediaRecorder.state&&(this.mediaRecorder.stop(),this.stream.getTracks().forEach((function(e){return e.stop()})))}},computed:Object(u["a"])(Object(u["a"])({},Object(T["d"])(["user"])),Object(T["b"])(["getIconMode"]))};n("aa09");const qn=O()(Nn,[["render",Fn]]);var Bn=qn,Hn={components:{Image:te,CopyIdButton:un,Modal:Re,Edit:xn,CreatePost:Bn,Posts:Je,SearchButton:rn},data:function(){return{showEditModal:!1,showLogoutModal:!1,newPost:null}},methods:Object(u["a"])({logOut:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,b.signOut();case 2:e.SET_USER(null),e.showLogoutModal=!1,e.$router.replace({name:"auth"});case 5:case"end":return t.stop()}}),t)})))()},onPostCreate:function(e){this.user.other.postsCount++,this.newPost=e}},Object(T["c"])(["SET_USER"])),computed:Object(u["a"])({},Object(T["d"])(["user"]))};n("1c97");const Kn=O()(Hn,[["render",Vt]]);var Gn=Kn;function Jn(e,t){return Object(r["z"])(),Object(r["g"])("h1",null,"404 Not Found")}const Zn={},Xn=O()(Zn,[["render",Jn]]);var Qn=Xn,Yn=Object(T["a"])({state:{user:null,showLoader:!0,iconMode:!1},mutations:{SET_USER:function(e,t){e.user=t},SET_USER_IMAGE:function(e,t){e.user.main.image=t},SET_USER_NAME:function(e,t){e.user.main.name=t},SET_LOADER:function(e,t){e.showLoader=t},SET_ICON_MODE:function(e,t){e.iconMode=t}},actions:{},modules:{},getters:{getUser:function(e){return e.user},getIconMode:function(e){return e.iconMode}}}),er=[{path:"/",name:"home",component:tt,meta:{header:!0,title:"Подписки"}},{path:"/auth",name:"auth",component:yt,meta:{header:!1,title:"Войти"}},{path:"/profile",name:"profile",component:Gn,meta:{header:!0,title:"Профиль"}},{path:"/:catchAll(.*)",name:"notFound",component:Qn,meta:{header:!0,title:"Страница не найдена"}}],tr=Object(E["a"])({history:Object(E["b"])("/vue-social-app/"),routes:er});function nr(){return rr.apply(this,arguments)}function rr(){return rr=Object(F["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){b.onAuthStateChanged(function(){var t=Object(F["a"])(regeneratorRuntime.mark((function t(n){var r,c,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=null,!n){t.next=7;break}return c=f.ref("users/".concat(n.uid,"/info")),t.next=5,c.get();case 5:a=t.sent,r=a.val();case 7:Yn.commit("SET_USER",r),e(n);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())})));case 1:case"end":return e.stop()}}),e)}))),rr.apply(this,arguments)}tr.afterEach((function(e){document.title=e.meta.title+" - Tim"})),tr.beforeEach(function(){var e=Object(F["a"])(regeneratorRuntime.mark((function e(t,n,r){var c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,nr();case 2:c=e.sent,c||"auth"===t.name?c&&"auth"===t.name?r({name:"profile"}):r():r({name:"auth"}),Yn.commit("SET_LOADER",!1);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}());var cr=tr,ar=(n("cdff"),n("c1c3"),n("3d78"),n("ad3d")),or=n("c074"),ir=n("b702"),sr=n("ecee"),ur={install:function(e,t){function n(e){return r.apply(this,arguments)}function r(){return r=Object(F["a"])(regeneratorRuntime.mark((function e(t){var n,r,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=f.ref(t),e.next=3,n.get();case 3:return r=e.sent,c=r.val(),c+=1,e.next=8,n.set(c);case 8:return e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)}))),r.apply(this,arguments)}e.provide("increaseCount",n)}};sr["c"].add(or["a"]),sr["c"].add(ir["a"]),Object(r["d"])(L).use(Yn).use(cr).use(ur).component("font-awesome-icon",ar["a"]).mount("#app");var lr=function(){Yn.commit("SET_ICON_MODE",window.innerWidth<478)};lr(),window.onresize=lr},"595c":function(e,t,n){},"692c":function(e,t,n){"use strict";n("825d")},"7c1a":function(e,t,n){},"80e5":function(e,t,n){"use strict";n("a069")},"825d":function(e,t,n){},"907c":function(e,t,n){"use strict";n("7c1a")},"92b8":function(e,t,n){},a069:function(e,t,n){},a371:function(e,t,n){},a944:function(e,t,n){},aa09:function(e,t,n){"use strict";n("f03e")},ae2c:function(e,t,n){"use strict";n("c644")},b344:function(e,t,n){"use strict";n("cc842")},b67d:function(e,t,n){},b9d4:function(e,t,n){"use strict";n("595c")},c1c3:function(e,t,n){},c644:function(e,t,n){},c727:function(e,t,n){"use strict";n("4d21")},cc842:function(e,t,n){},cdff:function(e,t,n){},d453:function(e,t,n){},dc9c:function(e,t,n){"use strict";n("f0bb")},e84a:function(e,t,n){"use strict";n("a371")},e8c2:function(e,t,n){"use strict";n("d453")},f03e:function(e,t,n){},f0bb:function(e,t,n){},fa2c:function(e,t,n){"use strict";n("2d1f")},fcfe:function(e,t,n){"use strict";n("92b8")}});
//# sourceMappingURL=app.ed0828b4.js.map